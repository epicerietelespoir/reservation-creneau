<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>R√©server un cr√©neau ‚Ä¢ √âpicerie T√©lespoir</title>

<!-- Firebase (vers. compat pour site statique) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>
<script>
  emailjs.init("q_q1Ymuq0qOD8IG6a"); // d√©j√† configur√©
</script>

<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 40px; }
  h1 { text-align: center; color: #273070; }
  .container { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
  input, button { padding: 10px; margin: 8px 0; width: 100%; }
  .slot-btn { margin: 5px 0; background: #273070; color: white; border: none; border-radius: 5px; cursor: pointer; }
  .slot-btn:disabled { background: #ccc; cursor: not-allowed; }
</style>

</head>
<body>

<div class="container">
  <h1>R√©server un cr√©neau</h1>

  <input type="text" id="prenom" placeholder="Pr√©nom" required>
  <input type="text" id="name" placeholder="Nom" required>
  <input type="email" id="email" placeholder="Email" required>

  <div id="slots"></div>
</div>

<script>
  //Liste des cr√©neaux possibles
  const slotsList = [
    "Lundi 10h", "Lundi 11h", "Lundi 14h",
    "Mardi 10h", "Mardi 11h", "Mardi 14h"
  ];

  //Init Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDKpM_xwciFWOjHb18bONOO2N5c4jliQTM",
    authDomain: "creneaux-26.firebaseapp.com",
    databaseURL: "https://creneaux26-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "creneaux-26",
    storageBucket: "creneaux-26.appspot.com",
    messagingSenderId: "925270932823",
    appId: "1:925270932823:web:1b0c438422145e3c30d212"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let takenSlots = [];

  //Affiche les cr√©neaux
  function renderSlots() {
    const div = document.getElementById("slots");
    div.innerHTML = "<h3>Cr√©neaux disponibles :</h3>";

    slotsList.forEach(slot => {
      const btn = document.createElement("button");
      btn.textContent = slot;
      btn.className = "slot-btn";
      btn.disabled = takenSlots.includes(slot);
      if (!btn.disabled) {
        btn.onclick = () => reserve(slot);
      }
      div.appendChild(btn);
    });
  }

  //Charge les cr√©neaux d√©j√† pris depuis Firebase
  db.ref('slots').once('value').then(snapshot => {
    const data = snapshot.val();
    takenSlots = data ? Object.keys(data) : [];
    renderSlots();
  });

  // R√©server un cr√©neau
  async function reserve(slot) {
    const prenom = document.getElementById("prenom").value.trim();
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    if (!prenom || !name || !email) {
      alert("Remplis tous les champs !");
      return;
    }
    // V√©rifier √† nouveau si le cr√©neau est d√©j√† pris
    const snap = await db.ref('slots/' + slot).get();
    if (snap.exists()) {
      alert("D√©sol√©, ce cr√©neau est d√©j√† pris !");
      return;
    }

    // Ajouter juste le cr√©neau dans la base
    db.ref('slots/' + slot).set(true);

    // ‚úâÔ∏è Emails (toi + client)
    emailjs.send("service_98v3zye", "template_ii2jcrg", { name, prenom, email, slot });
    emailjs.send("service_98v3zye", "template_glyge5x", { name, prenom, email, slot });

    alert(`R√©serv√© üéâ : ${slot}`);
    document.querySelectorAll("input, button").forEach(el => el.disabled = true);
  }
</script>

</body>
</html>
